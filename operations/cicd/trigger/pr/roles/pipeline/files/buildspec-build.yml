version: 0.2
env:
  shell: bash
phases:
  install:
    commands:
      - chmod +x gradlew
      - |
        next() {
          if [[ $CODEBUILD_BUILD_SUCCEEDING = 1 ]]; then
            echo "Executing $1"
            `./gradlew --build-cache $1`
          fi
        }
  build:
    commands:
      - printenv
      - next "clean build -x test"
  post_build:
    commands:
      - next "test"
      - next "jib"
reports:
  GradleCICDReportGroup:
    files:
      - "**/build/test-results/test/*.xml"
    discard-paths: no
    file-format: JunitXml